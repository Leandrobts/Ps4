<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>PS4 WebKit Vulnerability Scanner | Advanced Test</title>
    <style>
        body { background: #000; color: #0f0; font-family: monospace; padding: 20px; }
        #log { background: #111; border: 1px solid #333; padding: 15px; height: 600px; overflow-y: auto; white-space: pre-wrap; margin-top: 15px; }
        #browserInfo { margin-bottom: 15px; border: 1px solid #555; padding: 10px; }
        button { background: #4CAF50; color: white; border: none; padding: 8px 15px; margin: 5px; border-radius: 3px; }
        select { background: #222; color: #0f0; border: 1px solid #333; padding: 5px; margin: 5px; }
        .success { color: #4CAF50; }
        .danger { color: #f44336; }
        .warning { color: #FFC107; }
        .info { color: #2196F3; }
        .section { color: #9C27B0; font-weight: bold; margin: 10px 0; }
        .poc-potential { color: #FF9800; font-weight: bold; }
        .defense-bypass { color: #00BCD4; font-weight: bold; }
        .privilege-escalation { color: #FF4081; font-weight: bold; }
    </style>
</head>
<body>
    <h1>PS4 WebKit Vulnerability Scanner | Advanced Test</h1>

    <div id="browserInfo">
        <strong>User Agent:</strong> <span id="userAgent"></span><br>
        <strong>Platform:</strong> <span id="platform"></span><br>
    </div>

    <div>
        <select id="testSelector">
            <option value="all_advanced_poc">Run All Advanced POC Tests</option>
            <option value="oob_write_investigate">Investigate ArrayBuffer OOB Write Impact (Advanced)</option>
            <option value="csp_bypass_detailed">Detailed CSP Bypass Attempts</option>
            <option value="cors_bypass_investigate">Investigate Cross-Origin Bypass (Advanced)</option>
        </select>
        <button onclick="runSelectedTest()">Run Selected Test</button>
        <button onclick="clearLog()">Clear Log</button>
    </div>

    <div id="log"></div>

<script>
// ======================
// Collect Browser Information (unchanged)
// ======================
document.addEventListener('DOMContentLoaded', function() {
    const userAgentElement = document.getElementById('userAgent');
    const platformElement = document.getElementById('platform');

    try {
        if (userAgentElement) userAgentElement.textContent = navigator.userAgent;
    } catch (e) {
        console.error("Error getting userAgent:", e);
        if (userAgentElement) userAgentElement.textContent = "N/A";
    }
    try {
        if (platformElement) platformElement.textContent = navigator.platform;
    } catch (e) {
        console.error("Error getting platform:", e);
        if (platformElement) platformElement.textContent = "N/A";
    }
});

// ======================
// Logging Function (unchanged)
// ======================
function log(message, type = '') {
    const logDiv = document.getElementById('log');
    if (logDiv) {
        const line = document.createElement('div');
        line.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
        if (type) {
            line.className = type;
        }
        logDiv.appendChild(line);
        logDiv.scrollTop = logDiv.scrollHeight;
    } else {
        console.error("Error: #log element not found!");
    }
}

function clearLog() {
    const logDiv = document.getElementById('log');
    if (logDiv) {
        logDiv.innerHTML = '';
    }
}

// ======================
// Advanced POC Tests (Refined OOB Write and CORS)
// ======================
const pocTests = {
    "oob_write_investigate": async function() { /* ... (função modificada acima) ... */ },
    "csp_bypass_detailed": async function() { /* ... (função inalterada do script anterior) ... */ },
    "cors_bypass_investigate": async function() { /* ... (função modificada acima) ... */ },

    "all_advanced_poc": async function() {
        log("=== Running All Advanced POC Tests ===", "section");
        await pocTests["oob_write_investigate"]();
        await new Promise(resolve => setTimeout(resolve, 10000));
        await pocTests["csp_bypass_detailed"]();
        await new Promise(resolve => setTimeout(resolve, 10000));
        await pocTests["cors_bypass_investigate"]();
        await new Promise(resolve => setTimeout(resolve, 10000));
        log("\n=== All Advanced POC Tests Completed. Review logs and browser behavior thoroughly. ===", "section");
    }
};

// ======================
// Test Runner (Advanced)
// ======================
async function runSelectedTest() {
    const testSelector = document.getElementById('testSelector');
    const selectedTest = testSelector.value;

    clearLog();
    log("=== Starting Advanced POC Tests ===", "section");

    if (selectedTest === "all_advanced_poc") {
        await pocTests["all_advanced_poc"]();
    } else if (pocTests[selectedTest]) {
        await pocTests[selectedTest]();
        log(`\n=== POC Generation Completed for "${selectedTest}". Review logs and browser behavior closely. ===`, "section");
    } else {
        log(`Error: Test "${selectedTest}" not found.`, "danger");
    }

    log("\nAdvanced impact demonstration tests completed.", "info");
}

function clearLog() {
    const logDiv = document.getElementById('log');
    if (logDiv) {
        logDiv.innerHTML = '';
    }
}
</script>
</body>
</html>
