<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Laboratório de Exploração Avançada (v2.8.0 - Modularizado PS4)</title>
   <style>
        body { background: #1e1e1e; color: #d4d4d4; font-family: monospace; padding: 10px; font-size: 13px; }
        .container { margin-bottom: 20px; padding: 10px; background-color: #252526; border: 1px solid #333; border-radius: 5px; }
        h1, h2, h3 { color: #4ec9b0; border-bottom: 1px solid #4ec9b0; padding-bottom: 3px; margin-top:15px; }
        button { background-color: #007acc; color: white; border: none; padding: 6px 12px; cursor: pointer; border-radius: 3px; margin: 3px 0; font-size: 12px;}
        button:hover { background-color: #005c99; }
        #logOutput { background: #111; border: 1px solid #444; padding: 8px; height: 600px; overflow-y: auto; white-space: pre-wrap; margin-top: 8px; font-size: 12px; }
        .log-info { color: #6cf; }
        .log-test { color: #fff; font-weight: bold; }
        .log-subtest { color: #bbb; margin-left: 10px;}
        .log-error { color: #f44336; }
        .log-good { color: #4CAF50; }
        .log-vuln { color: #ff4444; font-weight: bold; }
        .log-critical { color: #f0f; font-weight: bold; } /* Magenta forte para crítico */
        .log-leak { color: #FFC107;}
        .log-ptr { color: #C39BD3;}
        .log-tool { color: #82AAFF; }
        .log-warn { color: #FFD700; }
        .log-analysis { color: #FF69B4; } /* Rosa choque para análise */
        .notes { background-color: #2a2a2a; padding: 8px; border-left: 3px solid #FFC107; font-style: italic; color: #aaa; margin-top:3px; margin-bottom:8px; font-size:11px;}
        input[type="number"], input[type="text"] { width: 80px; background-color: #333; color: #eee; border: 1px solid #555; padding: 3px; margin: 2px;}
    </style>
</head>
<body>
    <h1>Laboratório (v2.8.0 - Modularizado PS4 FW 12.02)</h1>
    <p class="notes">Foco: Modularidade, Grooming agressivo, corrupção de m_vector/m_length, testes de R/W OOB, conceitos de addrof/fakeobj.</p>
    <p class="notes">ALTO RISCO DE CRASH! Anote o último GAP/teste bem-sucedido se o navegador fechar.</p>

    <div class="container">
        <h2>Configurações Globais</h2>
        <label for="oobAllocSize">OOB Alloc Size (bytes):</label> <input type="number" id="oobAllocSize" value="288">
        <label for="baseOffset">Base Offset in DV (bytes):</label> <input type="number" id="baseOffset" value="128">
        <label for="initialBufSize">Initial Buffer Size (bytes):</label> <input type="number" id="initialBufSize" value="32">
    </div>

    <div id="logOutput"></div>

    <div class="container" id="moduleTestButtons">
        <h3>Testes de Módulos Individuais</h3>
        </div>

    <div class="container">
        <h2>Passo 0: Ativar Primitiva OOB</h2>
        <button id="btnTriggerOOB">Ativar Primitiva OOB</button>
    </div>

    <div class="container">
        <h2>Passo 1: Heap Grooming & Alocação da Vítima</h2>
        <p class.notes>Vítima e Buffer OOB devem ter o mesmo tamanho (controlado por 'OOB Alloc Size').</p>
        <label for="sprayCountBase">Spray Count (Base):</label> <input type="number" id="sprayCountBase" value="500">
        <label for="intermediateAllocs">Intermediate Allocs:</label> <input type="number" id="intermediateAllocs" value="100">
        <button id="btnRunGroomingStrategies">Executar Todas Estratégias de Grooming & Busca de GAP</button>
    </div>

     <div class="container">
        <h2>Passo 2: Busca Iterativa de GAP & Corrupção de Campos da Vítima</h2>
        <p class="notes">Tenta ler e sobrescrever `m_vector` e `m_length` da Vítima. Um CRASH ou leitura/escrita confirmada é o objetivo.</p>
        <div>
            <label for="gapStartScan">GAP Início:</label> <input type="number" id="gapStartScan" value="-64">
            <label for="gapEndScan">GAP Fim:</label> <input type="number" id="gapEndScan" value="128">
            <label for="gapStepScan">Passo GAP:</label> <input type="number" id="gapStepScan" value="4">
            <button id="btnTestSingleGap">Testar GAP Início como Único</button>
        </div>
        <button id="btnFindAndCorruptIterative">Iniciar Busca & Corrupção Iterativa (com config atual)</button>
        <button id="btnTestKnownGap">Testar Corrupção no Último GAP de Sucesso</button>
    </div>

    <div class="container">
        <h2>Passo 3: (Conceitual) Preparar Par addrof/fakeobj</h2>
        <p class="notes">Tenta usar a R/W OOB para fazer o m_vector de 'arr_leaker' apontar para 'arr_marker'. Requer um GAP de sucesso do Passo 2.</p>
        <label for="addrofGap">GAP para addrof:</label> <input type="number" id="addrofGap" value="">
        <button id="btnSetupAddrofConceptual">Preparar Par addrof/fakeobj (Conceitual)</button>
    </div>

    <div class="container">
        <h2>Passo 4: (Conceitual) Testar addrof/fakeobj</h2>
        <label for="objNameToLeak">Nome da Var Global para addrof (ex: 'PostExploitLib_Conceptual.arr_marker'):</label> <input type="text" id="objNameToLeak" style="width:250px" value="PostExploitLib_Conceptual.arr_marker">
        <button id="btnTestAddrofConceptual">Testar addrof (Conceitual)</button>
        <br>
        <label for="fakeObjAddrHex">Endereço Hex para fakeobj:</label> <input type="text" id="fakeObjAddrHex" value="0x4141414142424242">
        <button id="btnTestFakeobjConceptual">Testar fakeobj (Conceitual)</button>
    </div>

    <script type="module" src="js/app.mjs"></script>
</body>
</html>
