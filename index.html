<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>PS4 WebKit Exploit - Teste 3 Isolado</title>
</head>

<body>
    <h1>Teste 3 Isolado</h1>
    <div id="output"></div>

    <h2>Teste 3: Tentativa de Primitiva de Leitura de Memória (Exploratória e Robustos)</h2>
    <button id="memoryReadButton1">Tentar ler ArrayBuffer (indiretamente - global)</button>
    <pre id="memoryReadResult1"></pre>
    <button id="memoryReadButton2">Tentar ler propriedade de objeto (indiretamente - global)</button>
    <pre id="memoryReadResult2"></pre>
    <button id="memoryReadButton3">Tentar vazar informações de erro (global)</button>
    <pre id="memoryReadResult3"></pre>
    <button id="memoryReadButton4">Tentar ler com `atob`/`btoa` (global)</button>
    <pre id="memoryReadResult4"></pre>

    <script>
        const log = (message, type = 'info') => {
            const outputDiv = document.getElementById('output');
            if (outputDiv) {
                outputDiv.innerHTML += `<span style="color: ${type === 'error' ? 'red' : type === 'warning' ? 'orange' : 'blue'};">${new Date().toLocaleTimeString()} - ${message}\n</span>`;
            } else {
                console.error('Elemento #output não encontrado!');
            }
        };

        function prepareData() {
            log("Função prepareData() iniciada e concluída (para consistência).", 'info');
            let bufferSize = 64;
            let buffer = new ArrayBuffer(bufferSize);
            let view = new Uint8Array(buffer);
            return {
                buffer,
                view,
                bufferSize
            };
        }

        // --- Teste 3: Tentativa de Primitiva de Leitura de Memória (Exploratória e Robustos) ---
        (function() {
            log("\n--- Teste 3: Tentativa de Primitiva de Leitura de Memória (Exploratória e Robustos) ---", 'critical');
            prepareData();

            let globalLeakedBuffer;
            let globalLeakedObject;

            const memoryReadButton1 = document.getElementById('memoryReadButton1');
            const memoryReadButton2 = document.getElementById('memoryReadButton2');
            const memoryReadButton3 = document.getElementById('memoryReadButton3');
            const memoryReadButton4 = document.getElementById('memoryReadButton4');
            const memoryReadResult1 = document.getElementById('memoryReadResult1');
            const memoryReadResult2 = document.getElementById('memoryReadResult2');
            const memoryReadResult3 = document.getElementById('memoryReadResult3');
            const memoryReadResult4 = document.getElementById('memoryReadResult4');

            globalLeakedBuffer = new ArrayBuffer(8);
            const view = new Uint8Array(globalLeakedBuffer);
            view[0] = 0x41;
            view[1] = 0x42;

            globalLeakedObject = {
                secret1: "AAA",
                secret2: "BBB"
            };

            memoryReadButton1.addEventListener('click', function() {
                try {
                    let temp = new Uint8Array(globalLeakedBuffer);
                    memoryReadResult1.textContent = 'Tentativa leitura AB (indireta - global): ' + temp[0] + ',' + temp[1];
                    temp = null;
                } catch (e) {
                    memoryReadResult1.textContent = 'Erro: ' + e;
                }
            });

            memoryReadButton2.addEventListener('click', function() {
                try {
                    memoryReadResult2.textContent = 'Tentativa leitura obj (indireta - global): ' + globalLeakedObject.secret1 + ',' + globalLeakedObject.secret2;
                } catch (e) {
                    memoryReadResult2.textContent = 'Erro: ' + e;
                }
            });

            memoryReadButton3.addEventListener('click', function() {
                try {
                    throw new Error('Teste de Erro com Dados Sensíveis: ' + globalLeakedBuffer);
                } catch (e) {
                    memoryReadResult3.textContent = 'Informação de erro (global - pode vazar dados): ' + e.message;
                }
            });

            memoryReadButton4.addEventListener('click', function() {
                try {
                    const base64 = btoa(String.fromCharCode.apply(null, new Uint8Array(globalLeakedBuffer)));
                    memoryReadResult4.textContent = 'Tentativa leitura com btoa (global): ' + base64;
                    const decoded = atob(base64);
                    memoryReadResult4.textContent += '\\nDecodificado: ' + decoded.charCodeAt(0) + ',' + decoded.charCodeAt(1);
                } catch (e) {
                    memoryReadResult4.textContent = 'Erro btoa/atob (global): ' + e.message;
                }
            });
        })();
    </script>
</body>

</html>
