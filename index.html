<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>PS4 WebKit Exploit - Testes Avançados</title>
</head>

<body>
    <h1>Testes Avançados</h1>
    <div id="output"></div>

    <h2>Teste 1: Investigar a Memória da GPU</h2>
    <canvas id="gpuCanvas1" width="64" height="1" style="border: 1px solid black; margin-bottom: 10px;"></canvas>
    <pre id="gpuResult1"></pre>
    <button onclick="safeTestGPUMemory1()">Teste GPU 1: Padrão Linear Horizontal</button>

    <canvas id="gpuCanvas2" width="1" height="64" style="border: 1px solid black; margin-bottom: 10px;"></canvas>
    <pre id="gpuResult2"></pre>
    <button onclick="safeTestGPUMemory2()">Teste GPU 2: Padrão Linear Vertical</button>

    <canvas id="gpuCanvas3" width="8" height="8" style="border: 1px solid black; margin-bottom: 10px;"></canvas>
    <pre id="gpuResult3"></pre>
    <button onclick="safeTestGPUMemory3()">Teste GPU 3: Padrão de Xadrez</button>

    <canvas id="gpuCanvas4" width="16" height="16" style="border: 1px solid black; margin-bottom: 10px;"></canvas>
    <pre id="gpuResult4"></pre>
    <button onclick="safeTestGPUMemory4()">Teste GPU 4: Leitura Amostrada</button>

    <hr>

    <h2>Teste 2: Buscar Objetos de Interesse no Escopo Global</h2>
    <pre id="globalResult1"></pre>
    <button onclick="safeTestGlobalScope1()">Teste Global 1: Listar Propriedades</button>

    <pre id="globalResult2"></pre>
    <button onclick="safeTestGlobalScope2()">Teste Global 2: Inspeção Seletiva</button>

    <pre id="globalResult3"></pre>
    <button onclick="safeTestGlobalScope3()">Teste Global 3: Buscar por Nomes</button>

    <pre id="globalResult4"></pre>
    <button onclick="safeTestGlobalScope4()">Teste Global 4: Tentar Acessar Funções</button>

    <hr>

    <h2>Teste 3: Desenvolver Primitivas de Leitura/Escrita Mais Sofisticadas</h2>
    <canvas id="primitiveCanvas1" width="4" height="1" style="border: 1px solid black; margin-bottom: 10px;"></canvas>
    <pre id="primitiveResult1"></pre>
    <button onclick="safeTestPrimitives1()">Teste Primitiva 1: Escrita Controlada (RGBA)</button>

    <canvas id="primitiveCanvas2" width="1" height="4" style="border: 1px solid black; margin-bottom: 10px;"></canvas>
    <pre id="primitiveResult2"></pre>
    <button onclick="safeTestPrimitives2()">Teste Primitiva 2: Leitura Seletiva (Canal)</button>

    <canvas id="primitiveCanvas3" width="2" height="2" style="border: 1px solid black; margin-bottom: 10px;"></canvas>
    <pre id="primitiveResult3"></pre>
    <button onclick="safeTestPrimitives3()">Teste Primitiva 3: Deslocamento de Dados</button>

    <canvas id="primitiveCanvas4" width="2" height="2" style="border: 1px solid black; margin-bottom: 10px;"></canvas>
    <pre id="primitiveResult4"></pre>
    <button onclick="safeTestPrimitives4()">Teste Primitiva 4: Leitura Indireta (Offset)</button>

    <hr>

    <h2>Teste 4: Analisar a Disposição da Memória</h2>
    <pre id="memoryLayoutResult1"></pre>
    <button onclick="safeTestMemoryLayout1()">Teste Layout 1: Alocar e Ler (Sequencial)</button>

    <pre id="memoryLayoutResult2"></pre>
    <button onclick="safeTestMemoryLayout2()">Teste Layout 2: Alocar e Ler (Espaçado)</button>

    <pre id="memoryLayoutResult3"></pre>
    <button onclick="safeTestMemoryLayout3()">Teste Layout 3: Inspeção de Buffers Globais</button>

    <pre id="memoryLayoutResult4"></pre>
    <button onclick="safeTestMemoryLayout4()">Teste Layout 4: Tentativa de Overlap</button>

    <hr>

    <script>
        document.addEventListener('DOMContentLoaded', function() { // Garante que o código executa após o DOM ser carregado
            const outputDiv = document.getElementById('output');
            if (!outputDiv) {
                console.error('Elemento #output não encontrado!');
                return; // Impede a execução do restante do script se #output não existir
            } else {
                console.log('Elemento #output encontrado.');
            }

            const log = (message, type = 'info') => {
                if (outputDiv) {
                    outputDiv.textContent += message + '\n';
                    console.log(message); // Adiciona console.log para depuração
                } else {
                    console.error('Elemento #output não encontrado!');
                }
            };

            function prepareData() {
                log("Função prepareData() iniciada.", 'info');
                let bufferSize = 64;
                let buffer = new ArrayBuffer(bufferSize);
                let view = new Uint8Array(buffer);
                return {
                    buffer,
                    view,
                    bufferSize
                };
            }

            // --- Testes Refatorados com 'safe' prefixo e tratamento de erros ---
            function safeTestGPUMemory1() {
                try {
                    log("Iniciando Teste GPU 1", 'info');
                    testGPUMemory1();
                    log("Teste GPU 1 concluído", 'info');
                } catch (error) {
                    log(`Erro em safeTestGPUMemory1: ${error}`, 'error');
                }
            }

            function safeTestGPUMemory2() {
                try {
                    log("Iniciando Teste GPU 2", 'info');
                    testGPUMemory2();
                    log("Teste GPU 2 concluído", 'info');
                } catch (error) {
                    log(`Erro em safeTestGPUMemory2: ${error}`, 'error');
                }
            }

            function safeTestGPUMemory3() {
                try {
                    log("Iniciando Teste GPU 3", 'info');
                    testGPUMemory3();
                    log("Teste GPU 3 concluído", 'info');
                } catch (error) {
                    log(`Erro em safeTestGPUMemory3: ${error}`, 'error');
                }
            }

            function safeTestGPUMemory4() {
                try {
                    log("Iniciando Teste GPU 4", 'info');
                    testGPUMemory4();
                    log("Teste GPU 4 concluído", 'info');
                } catch (error) {
                    log(`Erro em safeTestGPUMemory4: ${error}`, 'error');
                }
            }

            function safeTestGlobalScope1() {
                try {
                    log("Iniciando Teste Global Scope 1", 'info');
                    testGlobalScope1();
                    log("Teste Global Scope 1 concluído", 'info');
                } catch (error) {
                    log(`Erro em safeTestGlobalScope1: ${error}`, 'error');
                }
            }

            function safeTestGlobalScope2() {
                try {
                    log("Iniciando Teste Global Scope 2", 'info');
                    testGlobalScope2();
                    log("Teste Global Scope 2 concluído", 'info');
                } catch (error) {
                    log(`Erro em safeTestGlobalScope2: ${error}`, 'error');
                }
            }

            function safeTestGlobalScope3() {
                try {
                    log("Iniciando Teste Global Scope 3", 'info');
                    testGlobalScope3();
                    log("Teste Global Scope 3 concluído", 'info');
                } catch (error) {
                    log(`Erro em safeTestGlobalScope3: ${error}`, 'error');
                }
            }

            function safeTestGlobalScope4() {
                try {
                    log("Iniciando Teste Global Scope 4", 'info');
                    testGlobalScope4();
                    log("Teste Global Scope 4 concluído", 'info');
                } catch (error) {
                    log(`Erro em safeTestGlobalScope4: ${error}`, 'error');
                }
            }

            function safeTestPrimitives1() {
                try {
                    log("Iniciando Teste Primitivas 1", 'info');
                    testPrimitives1();
                    log("Teste Primitivas 1 concluído", 'info');
                } catch (error) {
                    log(`Erro em safeTestPrimitives1: ${error}`, 'error');
                }
            }

            function safeTestPrimitives2() {
                try {
                    log("Iniciando Teste Primitivas 2", 'info');
                    testPrimitives2();
                    log("Teste Primitivas 2 concluído", 'info');
                } catch (error) {
                    log(`Erro em safeTestPrimitives2: ${error}`, 'error');
                }
            }

            function safeTestPrimitives3() {
                try {
                    log("Iniciando Teste Primitivas 3", 'info');
                    testPrimitives3();
                    log("Teste Primitivas 3 concluído", 'info');
                } catch (error) {
                    log(`Erro em safeTestPrimitives3: ${error}`, 'error');
                }
            }

            function safeTestPrimitives4() {
                try {
                    log("Iniciando Teste Primitivas 4", 'info');
                    testPrimitives4();
                    log("Teste Primitivas 4 concluído", 'info');
                } catch (error) {
                    log(`Erro em safeTestPrimitives4: ${error}`, 'error');
                }
            }

            function safeTestMemoryLayout1() {
                try {
                    log("Iniciando Teste Layout 1", 'info');
                    testMemoryLayout1();
                    log("Teste Layout 1 concluído", 'info');
                } catch (error) {
                    log(`Erro em safeTestMemoryLayout1: ${error}`, 'error');
                }
            }

            function safeTestMemoryLayout2() {
                try {
                    log("Iniciando Teste Layout 2", 'info');
                    testMemoryLayout2();
                    log("Teste Layout 2 concluído", 'info');
                } catch (error) {
                    log(`Erro em safeTestMemoryLayout2: ${error}`, 'error');
                }
            }

            function safeTestMemoryLayout3() {
                try {
                    log("Iniciando Teste Layout 3", 'info');
                    testMemoryLayout3();
                    log("Teste Layout 3 concluído", 'info');
                } catch (error) {
                    log(`Erro em safeTestMemoryLayout3: ${error}`, 'error');
                }
            }

            function safeTestMemoryLayout4() {
                try {
                    log("Iniciando Teste Layout 4", 'info');
                    testMemoryLayout4();
                    log("Teste Layout 4 concluído", 'info');
                } catch (error) {
                    log(`Erro em safeTestMemoryLayout4: ${error}`, 'error');
                }
            }

            // --- Funções de Teste Originais (mantidas para clareza) ---
            function testGPUMemory1() {
                const canvas = document.getElementById('gpuCanvas1');
                const ctx = canvas.getContext('2d');
                const resultElement = document.getElementById('gpuResult1');
                if (ctx) {
                    for (let i = 0; i < canvas.width; i++) {
                        ctx.fillStyle = `rgba(${i * 4 % 256}, ${(i * 4 + 85) % 256}, ${(i * 4 + 170) % 256}, 255)`;
                        ctx.fillRect(i, 0, 1, 1);
                    }
                    const imageData = ctx.getImageData(0, 0, canvas.width, 1).data;
                    resultElement.textContent = 'Padrão Horizontal RGBA: ' + Array.from(imageData).join(',');
                } else {
                    resultElement.textContent = 'Erro ao obter contexto GPU 1.';
                }
            }

            // ... (restante das funções de teste originais)

        }); // Fim do ouvinte DOMContentLoaded
    </script>
</body>

</html>
