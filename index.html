<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>PS4 WebKit Vulnerability Scanner | Enhanced Aggressive POC</title>
    <style>
        body { background: #000; color: #0f0; font-family: monospace; padding: 20px; }
        #log { background: #111; border: 1px solid #333; padding: 15px; height: 600px; overflow-y: auto; white-space: pre-wrap; margin-top: 15px; }
        #browserInfo { margin-bottom: 15px; border: 1px solid #555; padding: 10px; }
        button { background: #f44336; color: white; border: none; padding: 8px 15px; margin: 5px; border-radius: 3px; }
        select { background: #222; color: #0f0; border: 1px solid #333; padding: 5px; margin: 5px; }
        .success { color: #4CAF50; }
        .danger { color: #f44336; }
        .warning { color: #FFC107; }
        .info { color: #2196F3; }
        .section { color: #9C27B0; font-weight: bold; margin: 10px 0; }
        .poc-potential { color: #FF9800; font-weight: bold; }
        .defense-bypass { color: #00BCD4; font-weight: bold; }
        .privilege-escalation { color: #FF4081; font-weight: bold; }
    </style>
</head>
<body>
    <h1>PS4 WebKit Vulnerability Scanner | Enhanced Aggressive POC</h1>

    <div id="browserInfo">
        <strong>User Agent:</strong> <span id="userAgent"></span><br>
        <strong>Platform:</strong> <span id="platform"></span><br>
    </div>

    <div>
        <select id="testSelector">
            <option value="all_aggressive">Run All Aggressive Tests</option>
            <option value="oob_write_aggressive">Aggressive ArrayBuffer OOB Write Investigation</option>
            <option value="csp_bypass_aggressive">Aggressive CSP Bypass Attempts</option>
        </select>
        <button onclick="runSelectedTest()">Run Selected Test (Aggressive)</button>
        <button onclick="clearLog()">Clear Log</button>
    </div>

    <div id="log"></div>

<script>
// ======================
// Collect Browser Information (mantido como estava)
// ======================
document.addEventListener('DOMContentLoaded', function() {
    const userAgentElement = document.getElementById('userAgent');
    const platformElement = document.getElementById('platform');

    try {
        if (userAgentElement) userAgentElement.textContent = navigator.userAgent;
    } catch (e) {
        console.error("Error getting userAgent:", e);
        if (userAgentElement) userAgentElement.textContent = "N/A";
    }
    try {
        if (platformElement) platformElement.textContent = navigator.platform;
    } catch (e) {
        console.error("Error getting platform:", e);
        if (platformElement) platformElement.textContent = "N/A";
    }
});

// ======================
// Logging Function (mantido como estava)
// ======================
function log(message, type = '') {
    const logDiv = document.getElementById('log');
    if (logDiv) {
        const line = document.createElement('div');
        line.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
        if (type) {
            line.className = type;
        }
        logDiv.appendChild(line);
        logDiv.scrollTop = logDiv.scrollHeight;
    } else {
        console.error("Error: #log element not found!");
    }
}

function clearLog() {
    const logDiv = document.getElementById('log');
    if (logDiv) {
        logDiv.innerHTML = '';
    }
}

// ======================
// Aggressive POC Tests (MODIFICADO)
// ======================
const aggressiveTests = {
    "oob_write_aggressive": async function() {
        log("[EXPLOIT] Enhanced Aggressive ArrayBuffer OOB Write Investigation...", "info");
        try {
            const bufferSize = 32;
            const buffer = new ArrayBuffer(bufferSize);
            const view = new Uint8Array(buffer);
            const writeValues = [0xEE, 0x00, 0xFF]; // Mais valores para escrita
            const offsets = [-15, -10, -5, -1, 0, 1, 5, 10, bufferSize - 10, bufferSize - 5, bufferSize - 1, bufferSize, bufferSize + 5, bufferSize + 10, bufferSize + 15]; // Mais offsets
            const readOffsets = [-7, -3, 0, 3, 7, bufferSize - 7, bufferSize - 3, bufferSize, bufferSize + 3, bufferSize + 7];

            for (const writeValue of writeValues) {
                for (const writeOffset of offsets) {
                    log(`[OOB-AGG+] Attempting to write 0x${writeValue.toString(16).padStart(2, '0')} at offset ${writeOffset}...`, "info");
                    try {
                        view[writeOffset] = writeValue;
                        log(`‚ö†Ô∏è [OOB+] OOB write at offset <span class="math-inline">\{writeOffset\} \(value 0x</span>{writeValue.toString(16).padStart(2, '0')}) successful.`, "warning");
                        for (const readOffset of readOffsets) {
                            try {
                                const readValue = view[readOffset];
                                log(`[OOB-AGG+] Read 0x${readValue.toString(16).padStart(2, '0')} at offset ${readOffset} after write at ${writeOffset}.`, "info");
                                if (readOffset >= 0 && readOffset < bufferSize && readValue === writeValue && writeOffset >= bufferSize) {
                                    log(`<span class="poc-potential defense-bypass privilege-escalation">üö© [OOB+] Potential Corruption (Write:<span class="math-inline">\{writeOffset\}, Read\:</span>{readOffset}, Val:0x${readValue.toString(16).padStart(2, '0')})</span>`, "danger");
                                } else if (readOffset >= 0 && readOffset < bufferSize && readValue === writeValue && writeOffset < 0) {
                                    log(`<span class="poc-potential defense-bypass privilege-escalation">üö© [OOB+] Potential Corruption (Neg. Write:<span class="math-inline">\{writeOffset\}, Read\:</span>{readOffset}, Val:0x${readValue.toString(16).padStart(2, '0')})</span>`, "danger");
                                }
                            } catch (readError) {
                                log(`‚úÖ Error reading at offset ${readOffset}: ${readError.message}`, "success");
                            }
                        }
                    } catch (writeError) {
                        log(`‚úÖ OOB write at offset ${writeOffset} error: ${writeError.message}`, "success");
                    }
                    await new Promise(resolve => setTimeout(resolve, 300));
                }
            }

            log("[OOB-AGG+] Completed enhanced OOB write testing.", "info");

        } catch (e) {
            log(`‚ùå Test error: ${e.message}`, "danger");
        }
        return false
