<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>PS4 WebKit Security Scanner | FW 12.02</title>
    <style>
        body { background: #000; color: #0f0; font-family: monospace; padding: 20px; }
        #log { background: #111; border: 1px solid #333; padding: 15px; height: 500px; overflow-y: auto; white-space: pre-wrap; }
        button { background: #4CAF50; color: white; border: none; padding: 8px 15px; margin: 5px; border-radius: 3px; }
        select { background: #222; color: #0f0; border: 1px solid #333; padding: 5px; margin: 5px; }
        .success { color: #4CAF50; }
        .danger { color: #f44336; }
        .warning { color: #FFC107; }
        .info { color: #2196F3; }
        .section { color: #9C27B0; font-weight: bold; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>PS4 WebKit Security Scanner</h1>
    <h3>Firmware 12.02 | Safe Mode</h3>
    
    <div>
        <select id="testSelector">
            <option value="all">Run All Tests</option>
            <option value="memory">Memory Tests</option>
            <option value="dom">DOM Tests</option>
            <option value="syscall">Syscall Tests</option>
        </select>
        <button onclick="runSelectedTest()">Run Test</button>
        <button onclick="clearLog()">Clear Log</button>
    </div>
    
    <div id="log"></div>

<script>
// ======================
// Enhanced Logging System
// ======================
function log(message, type = "info") {
    const timestamp = new Date().toLocaleTimeString();
    const logElement = document.getElementById('log');
    logElement.innerHTML += `<span class="${type}">[${timestamp}] ${message}</span>\n`;
}

function clearLog() {
    document.getElementById('log').innerHTML = '';
}

// ======================
// Safe Test Functions
// ======================
const safeTests = {
    "memory": function() {
        log("[MEMORY] Testing basic allocations...", "info");
        try {
            // Safe array buffer test
            const buffer = new ArrayBuffer(8);
            const view = new Uint32Array(buffer);
            view[0] = 0x12345678;
            
            if (view[0] === 0x12345678) {
                log("✅ Basic memory operations working", "success");
            } else {
                log("⚠️ Memory corruption detected", "warning");
            }
            return false;
        } catch (e) {
            log(`❌ Memory test failed: ${e.message}`, "danger");
            return true;
        }
    },
    
    "dom": function() {
        log("[DOM] Testing basic DOM operations...", "info");
        try {
            const testDiv = document.createElement('div');
            testDiv.id = 'test-div';
            document.body.appendChild(testDiv);
            
            if (document.getElementById('test-div')) {
                log("✅ DOM operations working", "success");
                document.body.removeChild(testDiv);
            } else {
                log("⚠️ DOM manipulation failed", "warning");
            }
            return false;
        } catch (e) {
            log(`❌ DOM test failed: ${e.message}`, "danger");
            return true;
        }
    },
    
    "syscall": function() {
        log("[SYSCALL] Testing system interactions...", "info");
        try {
            // Just test if we can create a worker
            const worker = new Worker(URL.createObjectURL(
                new Blob(["self.postMessage('ok');"])
            );
            
            return new Promise((resolve) => {
                worker.onmessage = function(e) {
                    if (e.data === 'ok') {
                        log("✅ Basic workers working", "success");
                        resolve(false);
                    } else {
                        log("⚠️ Worker communication issue", "warning");
                        resolve(true);
                    }
                    worker.terminate();
                };
                
                setTimeout(() => {
                    log("❌ Worker timeout", "danger");
                    resolve(true);
                }, 1000);
            });
        } catch (e) {
            log(`❌ Worker test failed: ${e.message}`, "danger");
            return Promise.resolve(true);
        }
    }
};

// ======================
// Test Runner
// ======================
async function runSelectedTest() {
    const testSelector = document.getElementById('testSelector');
    const selectedTest = testSelector.value;
    
    clearLog();
    log("=== Starting Tests ===", "section");
    log("Running in safe mode - no kernel tests", "info");

    if (selectedTest === "all") {
        let failures = 0;
        for (const [testName, test] of Object.entries(safeTests)) {
            log(`\nRunning ${testName}...`, "info");
            if (await test()) failures++;
            await new Promise(resolve => setTimeout(resolve, 500));
        }
        log("\n=== Summary ===", "section");
        log(`Completed with ${failures} failures`, 
            failures > 0 ? "warning" : "success");
    } else {
        await safeTests[selectedTest]();
    }
    
    log("\nTest completed.", "info");
}
</script>
</body>
</html>
