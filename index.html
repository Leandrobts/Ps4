<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Laboratório de Exploração Avançada (v2.5.10 - Depuração Sintaxe)</title>
    <style>
        body { background: #1e1e1e; color: #d4d4d4; font-family: monospace; padding: 20px; }
        #logOutput { background: #111; border: 1px solid #444; padding: 10px; height: 200px; overflow-y: auto; white-space: pre-wrap; margin-top: 10px;}
        .log-info { color: #6cf; } .log-test { color: #fff; } .log-error { color: #f44336; }
    </style>
</head>
<body>
    <h1>Laboratório (v2.5.10 - Depuração Sintaxe)</h1>
    <p>Abra o console (F12) para ver erros.</p>
    <div id="logOutput"></div>

    <script>
        // Função log simplificada para teste
        function log(message, type = 'info', funcName = '') {
            const outputDiv = document.getElementById('logOutput');
            if (outputDiv) {
                const SANE_MSG = String(message).replace(/</g, "&lt;"); // Sanitização mínima
                outputDiv.innerHTML += `[${type}] ${SANE_MSG}\n`;
                outputDiv.scrollTop = outputDiv.scrollHeight;
            }
            // Log também para o console do navegador para garantir que vemos algo
            if(funcName) console.log(`[${funcName} | ${type}] ${message}`);
            else console.log(`[${type}] ${message}`);
        }

        log("Script v2.5.10 Carregado.", "info", "Init");

        // Definição de AdvancedInt64 (onde o erro foi reportado)
        // Copiada da versão anterior. Verifique esta seção cuidadosamente no seu editor.
        class AdvancedInt64 { 
            constructor(low, high) { 
                let buffer = new Uint32Array(2); 
                let bytes = new Uint8Array(buffer.buffer); 
                if (arguments.length > 2) { throw TypeError('AdvancedInt64 takes at most 2 args'); } 
                if (arguments.length === 0) { throw TypeError('AdvancedInt64 takes at min 1 args'); } 
                let is_one = false; 
                if (arguments.length === 1) { is_one = true; } 
                if (!is_one) { if (typeof (low) !== 'number' && typeof (high) !== 'number') { throw TypeError('low/high must be numbers'); } } 
                const check_range = (x) => (-0x80000000 <= x) && (x <= 0xffffffff); 
                if (typeof low === 'number') { 
                    if (!check_range(low)) { throw TypeError('low not a valid value: ' + low); } 
                    if (is_one) { high = 0; if (low < 0) { high = -1; } } 
                    else { if (!check_range(high)) { throw TypeError('high not a valid value: ' + high); } } 
                    buffer[0] = low; buffer[1] = high; 
                } else if (typeof low === 'string') { 
                    let hexstr = low; if (hexstr.substring(0, 2) === "0x") { hexstr = hexstr.substring(2); } 
                    if (hexstr.length % 2 === 1) { hexstr = '0' + hexstr; } 
                    if (hexstr.length > 16) { hexstr = hexstr.substring(hexstr.length - 16); } 
                    else { hexstr = hexstr.padStart(16, '0');} 
                    for (let i = 0; i < 8; i++) { bytes[i] = parseInt(hexstr.slice(14 - i*2, 16 - i*2), 16); } 
                } else if (typeof low === 'object') { 
                    if (low instanceof AdvancedInt64) { bytes.set(low.bytes); } 
                    else if (low.length === 8) { bytes.set(low); } 
                    else { throw TypeError("Array must have exactly 8 elements."); } 
                } else { throw TypeError('AdvancedInt64 does not support your object for conversion'); } 
                this.buffer = buffer; this.bytes = bytes; 
            } 
            low() { return this.buffer[0]; } 
            high() { return this.buffer[1]; } 
            toString(is_pretty) { // Esta é a área geral da linha 101 no script anterior
                let lowStr = this.low().toString(16).padStart(8, '0');
                let highStr = this.high().toString(16).padStart(8, '0');
                if (is_pretty) { 
                    highStr = highStr.substring(0, 4) + '_' + highStr.substring(4); 
                    lowStr = lowStr.substring(0, 4) + '_' + lowStr.substring(4);
                    return '0x' + highStr + '_' + lowStr;
                }
                return '0x' + highStr + lowStr;
            } 
            // Outros métodos de AdvancedInt64 (add, sub, etc.) omitidos para brevidade aqui,
            // MAS DEVEM ESTAR NO SEU SCRIPT SE triggerOOB_real precisar deles.
            // Por enquanto, para este teste de sintaxe, vamos manter simples.
        }
        log("Classe AdvancedInt64 definida (ou deveria estar).", "info", "Init");

        let oob_dataview_real = null; // Para que o botão do Passo 1 não reclame se for clicado
        
        // Passo 0 - Stub vazio
        async function triggerOOB_real() {
            log("triggerOOB_real (Passo 0) - STUB VAZIO EXECUTADO", "test", "triggerOOB_real");
            // Simular que oob_dataview_real foi criado para o próximo passo não reclamar
            oob_dataview_real = true; 
        }
    </script>

    <h2>Passo 0</h2>
    <button onclick="triggerOOB_real()">Ativar OOB (Stub Vazio)</button>

    <h2>Passo 1</h2>
    <button onclick="console.log('CONSOLE LOG PASSO 1 CLICADO'); alert('ALERTA PASSO 1 CLICADO'); log('Log Página: Botão Passo 1 Clicado!', 'test', 'Passo1_Direct');">
        Testar Botão Passo 1 (onclick direto)
    </button>

</body>
</html>
