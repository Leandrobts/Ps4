<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Laboratório de Exploração Modular (v3.5.1 - Correção Callbacks)</title>
   <style>
        body { background: #1e1e1e; color: #d4d4d4; font-family: monospace; padding: 10px; font-size: 13px; }
        .container { margin-bottom: 20px; padding: 10px; background-color: #252526; border: 1px solid #333; border-radius: 5px; }
        h1, h2, h3, h4 { color: #4ec9b0; border-bottom: 1px solid #4ec9b0; padding-bottom: 3px; margin-top:15px; }
        h4 { font-size: 1.0em; border-bottom-style: dashed; margin-top: 12px;margin-bottom: 8px;}
        button { background-color: #007acc; color: white; border: none; padding: 6px 12px; cursor: pointer; border-radius: 3px; margin: 3px 0; font-size: 12px;}
        button:hover { background-color: #005c99; }
        button:disabled { background-color: #555; color: #888; cursor: not-allowed; }
        select, input[type="text"], input[type="number"] { background-color: #333; color: #d4d4d4; border: 1px solid #555; padding: 5px; border-radius: 3px; margin: 3px 0; width: calc(100% - 12px); }
        input[type="checkbox"] { margin-right: 5px; vertical-align: middle;}
        textarea { width: calc(100% - 12px); background-color: #333; color: #d4d4d4; border: 1px solid #555; min-height: 60px; }
        .log-output { background-color: #1a1a1a; border: 1px solid #555; height: 400px; overflow-y: scroll; padding: 8px; white-space: pre; font-size: 12px; }
        .log-info { color: #9cdcfe; }
        .log-test { color: #4ec9b0; font-weight: bold; }
        .log-subtest { color: #4ec9b0; margin-left: 15px; }
        .log-vuln { color: #d16969; font-weight: bold; }
        .log-good { color: #b5cea8; }
        .log-warn { color: #ce9178; }
        .log-error { color: #f44747; font-weight: bold; }
        .log-critical { background-color: #f44747; color: white; font-weight: bold; padding: 1px 3px;}
        .log-leak { color: #c586c0; font-weight: bold; }
        .log-ptr { color: #c586c0; }
        .log-escalation { color: #ffd700; font-weight: bold;}
        .log-tool { color: #6A9955; }
        .log-analysis { color: #569cd6; font-style: italic; }
        .input-group { margin-bottom: 8px; }
        .input-group label { display: block; margin-bottom: 3px; color: #ccc; }
        .input-group small { color: #888; display: block; margin-top: 2px;}
        .flex-container { display: flex; justify-content: space-between; flex-wrap: wrap; }
        .flex-item { flex: 1; min-width: 300px; margin-right: 10px; }
        .flex-item:last-child { margin-right: 0; }
        .status-indicator { font-weight: bold; }
        .status-gap { color: #ffd700; }
        .status-base { color: #c586c0; }
        hr { border-color: #555; margin-top: 15px; margin-bottom: 15px;}
   </style>
</head>
<body>
    <h1>Laboratório de Exploração Modular (v3.5.1 - Correção Callbacks)</h1>

    <div class="container" id="global-setup-container">
        <h2>Passo 0: Configuração Global & Primitiva OOB</h2>
        <p><small>Define parâmetros para a alocação OOB e inicializa o ambiente base.</small></p>
        <div class="input-group">
            <label for="oobAllocSize">Tamanho da Alocação OOB Real (bytes):</label>
            <input type="number" id="oobAllocSize" value="32768" placeholder="Ex: 32768">
        </div>
        <div class="input-group">
            <label for="baseOffset">Offset Base na DataView (bytes):</label>
            <input type="number" id="baseOffset" value="128" placeholder="Ex: 128">
        </div>
        <div class="input-group">
            <label for="initialBufSize">Tamanho Buffer Inicial para Trigger OOB (bytes):</label>
            <input type="number" id="initialBufSize" value="32" placeholder="Ex: 32">
        </div>
        <button id="btnTriggerOOB">0. Configurar Primitiva OOB</button>
        <button id="btnClearOOB">Limpar Ambiente OOB</button>
        <button id="btnTestCoreModule">Testar Módulo Core</button>
        <h4>Status da Primitiva OOB:</h4>
        <p><small>A primitiva OOB é a base para todas as operações de leitura/escrita fora dos limites.</small></p>
        <div id="oobStatus">Não configurado</div>
    </div>

    <div class="container" id="heap-grooming-container">
        <h2>Passo 1: Heap Grooming Experimental</h2>
        <p><small>Técnicas para manipular a heap e posicionar objetos de forma controlada.</small></p>
        <p class="notes">Requer Passo 0 ativo.</p>
        <div class="input-group">
            <label for="victimObjectSize">Tamanho do Objeto Vítima (bytes):</label>
            <input type="number" id="victimObjectSize" value="32768" placeholder="Ex: 32768">
        </div>
        <button id="btnPrepareVictim">1a. Preparar Objeto Vítima</button>
        <hr>
        <h4>Grooming Experimental Avançado:</h4>
        <div class="input-group">
            <label for="sprayCount">Contagem de Spray:</label>
            <input type="number" id="sprayCount" value="500" placeholder="Ex: 500">
        </div>
        <div class="input-group">
            <label for="intermediateAllocCount">Alocações Intermediárias:</label>
            <input type="number" id="intermediateAllocCount" value="50" placeholder="Ex: 50">
        </div>
        <div class="input-group">
            <label for="sprayObjectSizeOverride">Tam. Obj. Spray (Override, bytes, opcional):</label>
            <input type="text" id="sprayObjectSizeOverride" placeholder="Ex: 256 ou deixe vazio">
        </div>
        <div class="input-group">
            <label for="holeCreationPattern">Padrão de Criação de Buracos:</label>
            <select id="holeCreationPattern">
                <option value="alternate_skip_one" selected>Alternado (Pula 1)</option>
                <option value="first_n">Primeiros N</option>
                <option value="last_n">Últimos N</option>
                <option value="random_n">N Aleatórios</option>
                <option value="none">Nenhum (Só Spray)</option>
            </select>
        </div>
        <button id="btnRunGroomingExperimental">1b. Executar Grooming Experimental</button>
        <button id="btnClearSprayArray">Limpar Spray Array</button>
    </div>

    <div class="container" id="victim-finder-container">
        <h2>Passo 2: Encontrar Vítima (Via OOB Read Scan)</h2>
        <p><small>Varre a memória OOB em busca de potenciais objetos TypedArray ou ponteiros de código.</small></p>
        <p class="notes">Requer Passo 0 ativo. Grooming (Passo 1) altamente recomendado antes.</p>
        <div class="input-group">
            <label for="leakedWebKitBaseHex">Endereço Base WebKit Vazado (Hex):</label>
            <input type="text" id="leakedWebKitBaseHex" placeholder="Ex: 0x100000 ou 0x7FABDEADBEEF">
            <small>Preencher este campo (se conhecido/vazado) aumenta drasticamente a precisão da busca.</small>
        </div>
        <button id="btnSetLeakedBase">Aplicar Base WebKit</button>

        <div class="input-group">
            <label for="victimFinderScanStartOffset">Offset Inicial da Varredura (Decimal/Hex):</label>
            <input type="text" id="victimFinderScanStartOffset" value="0x20" placeholder="Ex: 32 ou 0x20">
        </div>
        <div class="input-group">
            <label for="victimFinderScanRange">Range da Varredura (bytes):</label>
            <input type="number" id="victimFinderScanRange" value="2048" placeholder="Ex: 2048">
        </div>
        <div class="input-group">
            <label for="victimFinderScanStep">Passo da Varredura (bytes):</label>
            <input type="number" id="victimFinderScanStep" value="8" placeholder="Ex: 8 ou 16">
        </div>
        <button id="btnFindVictim">2. Encontrar Vítima/Ponteiros</button>
    </div>


    <div class="container" id="victim-corruption-container">
        <h2>Passo 3: Corromper Vítima Encontrada</h2>
        <p><small>Tenta corromper campos de um objeto TypedArray em um GAP específico.</small></p>
        <p class="notes">Requer Passo 0 ativo. Idealmente, use um GAP de um TypedArray encontrado no Passo 2.</p>
        <div class="input-group">
            <label for="gap_to_test_input">GAP para Teste Direto (Decimal/Hex):</label>
            <input type="text" id="gap_to_test_input" placeholder="Ex: 128 ou 0x80 (deixe vazio para último sucesso)">
            <small>Este é o offset relativo do início da janela OOB até o início do objeto vítima.</small>
        </div>
        <button id="btnTestCorruptKnownGap">3a. Testar Corrupção em GAP Conhecido/Input</button>
        <hr>
        <h4>Busca Iterativa de GAP para Corrupção:</h4>
        <div class="input-group">
            <label for="victimCorruptStartGap">GAP Inicial da Busca:</label>
            <input type="number" id="victimCorruptStartGap" value="0">
        </div>
        <div class="input-group">
            <label for="victimCorruptEndGap">GAP Final da Busca:</label>
            <input type="number" id="victimCorruptEndGap" value="256">
        </div>
        <div class="input-group">
            <label for="victimCorruptStepGap">Passo da Busca de GAP:</label>
            <input type="number" id="victimCorruptStepGap" value="8">
        </div>
        <button id="btnFindAndCorruptIterative">3b. Buscar e Corromper Iterativamente</button>
        <h4>Status da Corrupção:</h4>
        <p>Último GAP testado com sucesso (m_length alterado): <span id="last_successful_gap_display" class="status-indicator status-gap">N/A</span></p>
        <p>GAP atualmente em teste na busca iterativa: <span id="current_gap_display" class="status-indicator status-gap">N/A</span></p>
    </div>

    <div class="container" id="post-exploit-container">
        <h2>Passo 4: Primitivas de Pós-Exploração (Conceitual)</h2>
        <p><small>Configura e testa addrof (obter endereço) e fakeobj (criar objeto falso).</small></p>
        <p class="notes">Requer Passo 0 e Passo 3 (corrupção bem-sucedida) ativos.</p>
        <div class="input-group">
            <label for="addrofGap">GAP para addrof/fakeobj (Decimal/Hex):</label>
            <input type="text" id="addrofGap" placeholder="Ex: 128 ou 0x80 (deixe vazio para último sucesso)">
            <small>Use o GAP onde a corrupção da vítima foi bem-sucedida.</small>
        </div>
        <button id="btnSetupAddrofFakeobj">4a. Setup Addrof/Fakeobj</button>
        <hr>
        <h4>Testar Addrof:</h4>
        <div class="input-group">
            <label for="objectToLeak">Nome do Objeto para Addrof (Ex: 'arr_marker'):</label>
            <input type="text" id="objectToLeak" value="arr_marker">
        </div>
        <button id="btnTestAddrof">4b. Testar Addrof</button>
        <hr>
        <h4>Testar Fakeobj:</h4>
        <div class="input-group">
            <label for="fakeObjAddrHex">Endereço para Fakeobj (Hex):</label>
            <input type="text" id="fakeObjAddrHex" placeholder="Ex: 0xDEADBEEFCAFEBABE (use endereço de 'arr_marker' vazado)">
        </div>
        <button id="btnTestFakeobj">4c. Testar Fakeobj</button>
    </div>

    <div class="container" id="json-exploit-tests-container">
        <h2>Testes Adicionais: Exploração via JSON</h2>
        <h4>Teste de Recursão JSON (Potencial DoS):</h4>
        <p class="notes">Requer Passo 0 ativo (para limpar Object.prototype se necessário).</p>
        <div class="input-group">
            <label for="jsonRecursionScenario">Cenário de Teste de Recursão:</label>
            <select id="jsonRecursionScenario" style="margin-bottom: 5px;">
                <option value="scenario_recursive_keys_short">Chaves Recursivas (Curto)</option>
                <option value="scenario_recursive_keys_long">Chaves Recursivas (Longo)</option>
                <option value="scenario_large_object_shallow">Objeto Grande (JSON Raso)</option>
                <option value="scenario_poc_v23s_corrected" selected>PoC Estouro de Pilha (Corrigido)</option>
            </select>
        </div>
        <button id="btnRunJsonRecursionTest">Executar Teste de Recursão JSON</button>
        <hr>
        <h4>JSON como Gatilho para Interação OOB:</h4>
        <p class="notes">Requer Passo 0 ativo.</p>
        <div class="input-group">
            <label for="jsonOobTargetObject">Alvo para JSON.stringify:</label>
            <select id="jsonOobTargetObject" style="margin-bottom: 5px;">
                <option value="new_array_buffer" selected>Novo ArrayBuffer(128)</option>
                <option value="core_oob_buffer">Core.oob_array_buffer_real</option>
            </select>
        </div>
        <div class="input-group">
            <label for="jsonOobRelativeOffset">Offset OOB Relativo (Decimal/Hex):</label>
            <input type="text" id="jsonOobRelativeOffset" value="0x50" placeholder="Ex: 0 ou 0x0">
        </div>
        <div class="input-group">
            <label for="jsonOobValueToWriteHex">Valor para Escrita OOB (Hex):</label>
            <input type="text" id="jsonOobValueToWriteHex" value="0xDEADBEEF" placeholder="Ex: 0xDEADBEEF">
        </div>
        <div class="input-group">
            <label for="jsonOobBytesToReadWrite">Bytes para Leitura/Escrita OOB:</label> <input type="number" id="jsonOobBytesToReadWrite" value="1"> <small>(1, 2, 4, ou 8)</small>
        </div>
        <button id="btnRunJsonOOBExploit">Executar JSON como Gatilho OOB</button>
    </div>

    <div class="container">
        <h2>Log de Eventos</h2>
        <button id="btnClearLog">Limpar Log</button>
        <div id="logOutput" class="log-output"></div>
    </div>

    <script type="module" src="js/app.mjs"></script>
</body>
</html>
