<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>PS4 WebKit Vuln Scanner | POC + Impact + Extended Detection (Verbose Logging)</title>
    <style>
        /* Estilos CSS Idênticos */
        body { background: #000; color: #0f0; font-family: monospace; padding: 20px; transition: background-color 0.5s ease; /* Adiciona transição */}
        #log { background: #111; border: 1px solid #333; padding: 15px; height: 600px; overflow-y: auto; white-space: pre-wrap; margin-top: 15px; }
        #browserInfo { margin-bottom: 15px; border: 1px solid #555; padding: 10px; }
        button { background: #f44336; color: white; border: none; padding: 8px 15px; margin: 5px; border-radius: 3px; }
        select { background: #222; color: #0f0; border: 1px solid #333; padding: 5px; margin: 5px; }
        .success { color: #4CAF50; }
        .danger { color: #f44336; }
        .warning { color: #FFC107; }
        .info { color: #2196F3; }
        .section { color: #9C27B0; font-weight: bold; margin: 10px 0; }
        .poc-potential { color: #FF9800; font-weight: bold; }
        .defense-bypass { color: #00BCD4; font-weight: bold; }
        .privilege-escalation { color: #FF4081; font-weight: bold; }
        .impact { color: #E91E63; font-style: italic; }
        .notification { color: #7B1FA2; font-style: italic; }
        .extended-test { color: #03A9F4; }
        .verbose-log { color: #BDBDBD; font-size: 0.9em; }
        /* Estilo para o overlay de impacto DOM */
        #csp-impact-overlay {
            position: fixed; top: 10%; left: 10%; width: 80%; height: 80%;
            background: rgba(255, 0, 0, 0.85); color: white;
            border: 5px solid white; font-size: 2em; text-align: center;
            display: flex; justify-content: center; align-items: center;
            z-index: 10000; flex-direction: column;
            opacity: 0; transition: opacity 0.5s ease-in-out; /* Animação */
        }
    </style>
</head>
<body>
    <h1>PS4 WebKit Vuln Scanner | POC + Impact + Extended Detection (Verbose Logging)</h1>
    <div id="browserInfo">...</div>
    <div><select id="testSelector">...</select>...</div>
    <div id="log"></div>
    <div id="csp-impact-overlay" style="opacity: 0;"></div>

<script>
// ======================
// CONFIGURAÇÃO E FUNÇÕES BÁSICAS (Idênticas)
// ======================
const NOTIFICATION_ENDPOINT = 'https://httpbin.org/post'; // <-- MUDE AQUI!
// ... (Restante das funções básicas idênticas: DOMContentLoaded, log, clearLog, potentialVulnsFound, sendVulnerabilityNotification, demonstrateCookieRead) ...

// ======================
// Função de Impacto DOM Modificada para ser mais visual
// ======================
function demonstrateDomManipulation() {
    try {
        let overlay = document.getElementById('csp-impact-overlay');
        if (!overlay) { // Criar se não existir
            overlay = document.createElement('div');
            overlay.id = 'csp-impact-overlay';
            document.body.appendChild(overlay);
        }
        // Definir conteúdo e estilo
        overlay.innerHTML = `
            <h2>CSP Bypass Successful!</h2>
            <p>DOM Manipulation Demonstrated.</p>
            <p style="font-size: 0.7em;">(This overlay proves JS execution)</p>
            <button onclick="document.getElementById('csp-impact-overlay').style.opacity=0; setTimeout(()=>document.getElementById('csp-impact-overlay').remove(), 500);"
                    style="padding: 10px; margin-top: 20px; background: white; color: red; border: none; font-size: 0.8em;">
                Close Proof
            </button>
        `;
        // Forçar reflow e então aplicar opacidade para animação
        overlay.offsetHeight; // Force reflow
        overlay.style.opacity = 1;

        log('[IMPACT-CSP] DOM Manipulation Executed: Displayed visual overlay.', 'impact danger');

        // Opcional: Remover automaticamente após um tempo
        // setTimeout(() => {
        //    try { overlay.style.opacity = 0; setTimeout(()=>overlay.remove(), 500); } catch(e){}
        // }, 10000); // Remover após 10s

    } catch(e) {
        log('[IMPACT-CSP] Error manipulating DOM: ' + e.message, 'danger');
    }
}
// Função demonstrateNetworkRequest idêntica à anterior
function demonstrateNetworkRequest() { /* ... código idêntico anterior ... */ }


// ======================
// Aggressive POC Tests (Com Novas Detecções e Info Leak)
// ======================
const aggressiveTests = {
    // Funções: oob_write_aggressive, test_oob_metadata, test_oob_crash_probe, csp_bypass_aggressive,
    // uaf_basic_verbose, type_confusion_basic_verbose, all_tests, oob_impact_tests
    // Mantêm-se idênticas à última versão que te enviei (message #28),
    // pois elas já chamam as funções de impacto (demonstrate*) que foram atualizadas acima.
    /* ... Colar aqui o código completo do objeto aggressiveTests da resposta anterior ... */
     "oob_write_aggressive": async function() { /* ... código da resposta #28 ... */ },
     "test_oob_metadata": async function() { /* ... código da resposta #28 ... */ },
     "test_oob_crash_probe": async function() { /* ... código da resposta #28 ... */ },
     "csp_bypass_aggressive": async function() { /* ... código da resposta #28 ... */ },
     "uaf_basic_verbose": async function() { /* ... código da resposta #28 ... */ },
     "type_confusion_basic_verbose": async function() { /* ... código da resposta #28 ... */ },
     "all_tests": async function() { /* ... código da resposta #28 ... */ },
     "oob_impact_tests": async function() { /* ... código da resposta #28 ... */ }
     ,"uaf_basic": async function() { await this.uaf_basic_verbose(); }
     ,"type_confusion_basic": async function() { await this.type_confusion_basic_verbose(); }
};
aggressiveTests["uaf_basic_verbose"] = aggressiveTests.uaf_basic_verbose;
aggressiveTests["type_confusion_basic_verbose"] = aggressiveTests.type_confusion_basic_verbose;


// ======================
// Test Runner (Atualizado)
// ======================
async function runSelectedTest() { /* ... código idêntico da resposta #28 ... */ }

</script>
</body>
</html>
