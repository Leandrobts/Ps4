<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>PoC Original v9 (Base Intacta)</title> <style>
        /* Estilos CSS Originais */
        body { background: #111; color: #eee; font-family: monospace; padding: 15px; font-size: 14px; }
        #output { background: #222; border: 1px solid #444; padding: 10px; height: 80vh; overflow-y: auto; white-space: pre-wrap; margin-top: 10px; }
        .log-info { color: #6cf; } .log-test { color: #fff; font-weight: bold; margin-top: 10px; display: block; border-top: 1px dashed #555; padding-top: 5px; }
        .log-subtest { color: #eee; font-weight: bold; margin-left: 10px; } .log-vuln { color: #ff4444; font-weight: bold; }
        .log-good { color: #4CAF50; } .log-warn { color: #FFC107; } .log-error { color: #f44336; }
        .log-leak { color: #FF9800; font-weight: bold; } .log-ptr { color: #f0f; font-weight: bold; }
        #xss-target-div { border: 2px dotted red; padding: 5px; margin: 15px 0; color: yellow; min-height: 40px; }
    </style>
</head>
<body>
    <h1>PoC Original v9 (Base Intacta)</h1>
    <p>Testa: XSS, OOB R/W (Info Leak), PP Básica, PP Hijack (JSON.stringify com Interação).</p>
    <button id="runBtn" onclick="runAllTests()">Iniciar Testes Originais</button> <div id="output"></div>
    <div id="xss-target-div">Área para teste de XSS DOM.</div>

    <script>
        // --- Globals & Setup Originais ---
        const outputDiv = document.getElementById('output');
        const runBtn = document.getElementById('runBtn');
        const SHORT_PAUSE = 50; // ms
        const MEDIUM_PAUSE = 500; // ms
        let leakedValueFromOOB = null; // Armazena valor do Info Leak

        // --- Função de Log Original ---
        const log = (message, type = 'info') => {
             if (!outputDiv) return;
             try { /* ... (lógica de log original) ... */ } catch(e) { console.error("Erro na função log:", e); outputDiv = null; }
        };

        // --- Helpers Originais ---
        const toHex = (val, bits = 32) => { /* ... (lógica original) ... */ };
        const isPotentialPointer64 = (high, low) => { /* ... (lógica original) ... */ };
        const isPotentialData32 = (val) => { /* ... (lógica original) ... */ };

        // --- Teste 1 Original: CSP Bypass / XSS --- (Com alert)
        const testCSPBypass = async () => { /* ... (Código EXATO Teste 1 original) ... */ };

        // --- Teste 2 Original: OOB Write/Read Extensivo ---
        const testOOBReadInfoLeakEnhancedStore = async () => { /* ... (Código EXATO Teste 2 original) ... */ };

        // --- Teste 3 Original: Prototype Pollution (Básica) ---
        const testBasicPP = async () => { /* ... (Código EXATO Teste 3 original) ... */ };

        // --- Teste 4 Original: PP Hijack (JSON.stringify com Interação) ---
        const testPPJsonHijack = async () => { /* ... (Código EXATO Teste 4 original) ... */ };

        // --- Função Principal Original para Rodar Todos os Testes ---
        const runAllTests = async () => {
             // Código EXATO de runAllTests do script original
             if (runBtn) runBtn.disabled = true;
             log("==== INICIANDO PoC Final v9 (PP Hijack JSON) ====", 'critical');
             await testCSPBypass(); // Teste 1
             await new Promise(resolve => setTimeout(resolve, MEDIUM_PAUSE));
             await testOOBReadInfoLeakEnhancedStore(); // Teste 2
             await new Promise(resolve => setTimeout(resolve, MEDIUM_PAUSE));
             await testBasicPP(); // Teste 3
             await new Promise(resolve => setTimeout(resolve, MEDIUM_PAUSE));
             await testPPJsonHijack(); // Teste 4
             await new Promise(resolve => setTimeout(resolve, MEDIUM_PAUSE));
             log("\n==== PoC Final v9 CONCLUÍDA ====", 'critical');
             if (runBtn) runBtn.disabled = false;
         };

        // document.addEventListener('DOMContentLoaded', runAllTests); // Original comentado
    </script>

</body>
</html>
