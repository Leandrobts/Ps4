<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>PS4 WebKit Exploit - Teste GPU Memory (Isolado)</title>
</head>

<body>
    <h1>Teste GPU Memory (Isolado)</h1>
    <div id="output"></div>

    <h2>Teste 1: Investigar a Memória da GPU</h2>
    <canvas id="gpuCanvas1" width="64" height="1" style="border: 1px solid black; margin-bottom: 10px;"></canvas>
    <pre id="gpuResult1"></pre>
    <button id="gpuButton1">Teste GPU 1: Padrão Linear Horizontal</button>

    <canvas id="gpuCanvas2" width="1" height="64" style="border: 1px solid black; margin-bottom: 10px;"></canvas>
    <pre id="gpuResult2"></pre>
    <button id="gpuButton2">Teste GPU 2: Padrão Linear Vertical</button>

    <canvas id="gpuCanvas3" width="8" height="8" style="border: 1px solid black; margin-bottom: 10px;"></canvas>
    <pre id="gpuResult3"></pre>
    <button id="gpuButton3">Teste GPU 3: Padrão de Xadrez</button>

    <canvas id="gpuCanvas4" width="16" height="16" style="border: 1px solid black; margin-bottom: 10px;"></canvas>
    <pre id="gpuResult4"></pre>
    <button id="gpuButton4">Teste GPU 4: Leitura Amostrada</button>

    <script>
        const log = (message, type = 'info') => {
            const outputDiv = document.getElementById('output');
            if (outputDiv) {
                outputDiv.innerHTML += `<span style="color: ${type === 'error' ? 'red' : type === 'warning' ? 'orange' : 'blue'};">${new Date().toLocaleTimeString()} - ${message}\n</span>`;
            } else {
                console.error('Elemento #output não encontrado!');
            }
        };

        function prepareData() {
            log("Função prepareData() iniciada e concluída (para consistência).", 'info');
            let bufferSize = 64;
            let buffer = new ArrayBuffer(bufferSize);
            let view = new Uint8Array(buffer);
            return {
                buffer,
                view,
                bufferSize
            };
        }

        // --- Teste 1: Investigar a Memória da GPU ---
        function testGPUMemory1() {
            log("\n--- Teste 1: Investigar a Memória da GPU ---", 'critical');
            prepareData();
            const canvas = document.getElementById('gpuCanvas1');
            const ctx = canvas.getContext('2d');
            const resultElement = document.getElementById('gpuResult1');
            console.log('testGPUMemory1: canvas, ctx, resultElement:', canvas, ctx, resultElement); // Depuração
            if (ctx) {
                for (let i = 0; i < canvas.width; i++) {
                    ctx.fillStyle = `rgba(${i * 4 % 256}, ${(i * 4 + 85) % 256}, ${(i * 4 + 170) % 256}, 255)`;
                    ctx.fillRect(i, 0, 1, 1);
                }
                const imageData = ctx.getImageData(0, 0, canvas.width, 1).data;
                resultElement.textContent = 'Padrão Horizontal RGBA: ' + Array.from(imageData).join(',');
            } else {
                resultElement.textContent = 'Erro ao obter contexto GPU 1.';
            }
        }

        function testGPUMemory2() {
            log("\n--- Teste 1: Investigar a Memória da GPU ---", 'critical');
            prepareData();
            const canvas = document.getElementById('gpuCanvas2');
            const ctx = canvas.getContext('2d');
            const resultElement = document.getElementById('gpuResult2');
            console.log('testGPUMemory2: canvas, ctx, resultElement:', canvas, ctx, resultElement); // Depuração
            if (ctx) {
                for (let i = 0; i < canvas.height; i++) {
                    ctx.fillStyle = `rgba(${(i * 4 + 170) % 256}, ${i * 4 % 256}, ${(i * 4 + 85) % 256}, 255)`;
                    ctx.fillRect(0, i, 1, 1);
                }
                const imageData = ctx.getImageData(0, 0, 1, canvas.height).data;
                resultElement.textContent = 'Padrão Vertical RGBA: ' + Array.from(imageData).join(',');
            } else {
                resultElement.textContent = 'Erro ao obter contexto GPU 2.';
            }
        }

        function testGPUMemory3() {
            log("\n--- Teste 1: Investigar a Memória da GPU ---", 'critical');
            prepareData();
            const canvas = document.getElementById('gpuCanvas3');
            const ctx = canvas.getContext('2d');
            const resultElement = document.getElementById('gpuResult3');
            console.log('testGPUMemory3: canvas, ctx, resultElement:', canvas, ctx, resultElement); // Depuração
            if (ctx) {
                for (let y = 0; y < canvas.height; y++) {
                    for (let x = 0; x < canvas.width; x++) {
                        ctx.fillStyle = (x % 2 === y % 2) ? 'black' : 'white';
                        ctx.fillRect(x, y, 1, 1);
                    }
                }
                const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height).data;
                resultElement.textContent = 'Padrão Xadrez RGBA: ' + Array.from(imageData).join(',');
            } else {
                resultElement.textContent = 'Erro ao obter contexto GPU 3.';
            }
        }

        function testGPUMemory4() {
            log("\n--- Teste 1: Investigar a Memória da GPU ---", 'critical');
            prepareData();
            const canvas = document.getElementById('gpuCanvas4');
            const ctx = canvas.getContext('2d');
            const resultElement = document.getElementById('gpuResult4');
            console.log('testGPUMemory4: canvas, ctx, resultElement:', canvas, ctx, resultElement); // Depuração
            if (ctx) {
                ctx.fillStyle = 'red';
                ctx.fillRect(0, 0, 8, 8);
                ctx.fillStyle = 'blue';
                ctx.fillRect(8, 8, 8, 8);
                const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height).data;
                // Tentativa de ler alguns pixels espaçados
                const sampledData = [
                    imageData[0], imageData[1], imageData[2], imageData[3], // (0,0) Red
                    imageData[4 * 8 * 4 + 0], imageData[4 * 8 * 4 + 1], imageData[4 * 8 * 4 + 2], imageData[4 * 8 * 4 + 3], // (8,0) ?
                    imageData[8 * 8 * 4 + 0], imageData[8 * 8 * 4 + 1], imageData[8 * 8 * 4 + 2], imageData[8 * 8 * 4 + 3], // (0,8) ?
                    imageData[12 * 12 * 4 + 0], imageData[12 * 12 * 4 + 1], imageData[12 * 12 * 4 + 2], imageData[12 * 12 * 4 + 3] // (12,12) Blue
                ];
                resultElement.textContent = 'Leitura Amostrada RGBA: ' + sampledData.join(',');
            } else {
                resultElement.textContent = 'Erro ao obter contexto GPU 4.';
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('gpuButton1').addEventListener('click', testGPUMemory1);
            document.getElementById('gpuButton2').addEventListener('click', testGPUMemory2);
            document.getElementById('gpuButton3').addEventListener('click', testGPUMemory3);
            document.getElementById('gpuButton4').addEventListener('click', testGPUMemory4);
        });
    </script>
</body>

</html>
